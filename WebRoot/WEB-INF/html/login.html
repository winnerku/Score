<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html>
<head>
<title>学生成绩管理</title>

<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
<meta http-equiv="description" content="this is my page">
<meta http-equiv="content-type" content="text/html; charset=utf8">
<meta http-equiv="Expires" CONTENT="0"> 
<meta http-equiv="Cache-Control" CONTENT="no-cache"> 
<meta http-equiv="Pragma" CONTENT="no-cache"> 
<link rel="shortcut icon" href="/html/ico/favicon.ico" />
<link rel="stylesheet" type="text/css" href="/html/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css"
	href="/html/css/bootstrap-responsive.min.css">
<link rel="stylesheet" type="text/css" href="/html/css/font-awesome.css">
<link rel="stylesheet" type="text/css" href="/html/css/login.css">
<link rel="stylesheet" type="text/css"
	href="/html/css/messenger-theme-future.css">
<link rel="stylesheet" type="text/css" href="/html/css/messenger.css">
<link rel="stylesheet" type="text/css"
	href="/html/css/jquery-ui-1.10.2.custom.min.css">
  <!--[if IE 7]>
  <link rel="stylesheet" href="/html/css/font-awesome-ie7.min.css">
  <![endif]-->
<script type="text/javascript" src="/html/js/jquery-1.9.0.js"></script>
<script type="text/javascript"
	src="/html/js/jquery-ui-1.10.2.custom.min.js"></script>
<script type="text/javascript" src="/html/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/html/js/jquery.validate.js"></script>
<script type="text/javascript" src="/html/js/messenger.min.js"></script>
<script type="text/javascript">
	$(function() {
		$._messengerDefaults = {
			extraClasses : 'messenger-fixed messenger-theme-future messenger-on-bottom'
		};
		$("#lost").click(function() {
			$("#form-signin").hide("blind", {}, 500);
			$("#form-lostpassword").show("blind", {}, 500);
		});
		$("#back").click(function() {
			$("#form-signin").show("blind", {}, 500);
			$("#form-lostpassword").hide("blind", {}, 500);
		});
		$("#form-lostpassword").validate({
			rules : {
				lostemail : {
					required : true,
					email : true
				}
			},
			messages : {
				lostemail : {
					required : "请输入邮箱!",
					email : "请输入正确的邮箱!"
				}
			},
			highlight : function(element, errorClass, validClass) {
				$(element).parents('.control-group').addClass('error');
			},
			unhighlight : function(element, errorClass, validClass) {
				$(element).parents('.control-group').removeClass('error');
				$(element).parents('.control-group').addClass('success');
			},
			errorPlacement : function(error, element) {
				var id = $(element).attr("id");
				$.globalMessenger().post({
					message : $(error).html(),
					type : "error",
					id : id
				});
			}
		});
		$("#form-signin").validate({
			rules : {
				email : {
					required : true,
					email : true
				},
				password : {
					required : true,
					minlength : 5
				}
			},
			messages : {
				email : {
					required : "请输入邮箱!",
					email : "请输入正确的邮箱!"
				},
				password : {
					required : "请输入密码!",
					minlength : "密码长度不能少于{0}个字符!"
				}
			},
			highlight : function(element, errorClass, validClass) {
				$(element).parents('.control-group').addClass('error');
			},
			unhighlight : function(element, errorClass, validClass) {
				$(element).parents('.control-group').removeClass('error');
				$(element).parents('.control-group').addClass('success');
			},
			errorPlacement : function(error, element) {
				var id = $(element).attr("id");
				$.globalMessenger().post({
					message : $(error).html(),
					type : "error",
					id : id
				});
			}
		});
		$("#login").click(function() {
			if ($("#form-signin").valid()) {
				$("#login").attr("disabled",true);
				$.globalMessenger().post({
					message : "正在登陆,请稍后...",
					type : "success",
					id:"logining"
				});
				$.ajax({
					type : "POST",
					url : "/login.json",
					data : {
						username : $("#email").val(),
						password : $("#password").val()
					},
					success : function(data) {
						if(data.success=="false"){
							$.globalMessenger().post({
								message : data.msg,
								type : "error",
								id:"logining"
							});
							$("#login").attr("disabled",false);
							$("#password").val("");
						}else{
							window.location.replace(data.url);
						}
					},
					dataType : "json",
					timeout : 5000,
					error : function(jqXHR, textStatus, errorThrown) {
						var msg="登陆失败,请稍后重试...";
						if(textStatus=="timeout"){
							msg="登陆超时,请稍后重试...";
						}
						$.globalMessenger().post({
							message : msg,
							type : "error",
							id:"logining"
						});
						$("#login").attr("disabled",false);
						$("#password").val("");
					}
				});
			}
		});
		$("#send").click(function() {
			if ($("#form-lostpassword").valid()) {
				$.post("/sendemail", {
					username : $("#lostemail").val()
				}, function(data) {
					alert(data.success);
				}, "json");
			}
		});
	});
</script>
</head>
<body>
	<div class="container">
		<h2 class="form-signin-heading" align="center">学生成绩管理</h2>
		<form id="form-signin" name="form-signin" action="/login"
			method="post">
			<div class="div-center">
				<div class="input-prepend control-group">
					<span class="add-on"><i class="icon-envelope"></i> </span> <input
						class="span2.5" type="text" placeholder="邮箱/Email" name="email"
						id="email" />
				</div>
				<div class="input-prepend control-group">
					<span class="add-on"><i class="icon-key"></i> </span> <input
						class="span2.5" type="password" placeholder="密码/Password"
						name="password" id="password" />
				</div>
			</div>
			<button class="btn btn-small btn-warning" type="button" name="lost"
				id="lost">忘记密码?</button>
			<button class="btn btn-small btn-success span1" style="float:right;"
				type="button" name="login" id="login">登录</button>
		</form>
		<form id="form-lostpassword">
			<div align="center">
				<div class="alert alert-success" align="center">
					<span class="add-on"><i class="icon-exclamation-sign"></i> </span>请输入您的邮箱,我们将会教您如何找回您的密码!
				</div>
				<div class="input-prepend control-group">
					<span class="add-on"><i class="icon-envelope"></i> </span> <input
						class="span2.5" type="text" placeholder="邮箱/Email"
						name="lostemail" id="lostemail" />
				</div>
			</div>
			<button class="btn btn-small btn-warning" type="button" name="back"
				id="back">返回登录</button>
			<button class="btn btn-small btn-success span1" type="button"
				style="float:right;" name="send" id="send">发送</button>
		</form>
	</div>
</body>
</html>
